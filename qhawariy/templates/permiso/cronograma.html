{% extends 'base.html' %}
{% block title %}
    Cronograma flota
{% endblock %}
{% block head %}
    {{ super() }}
    <script src="{{ url_for('static', filename='source/js/gantt/gantt-chart.js') }}"  type="module"></script>
{% endblock %}
{% block navigation %}
    {% if current_user.is_authenticated %}
        <a href="{{url_for('home.index')}}" class="q-icon-costumer">
            <div class="mr-4 w-6 h-6">
                <img src="{{ url_for('static', filename='img/home.svg') }}" alt="qhawariy" srcset="" class="block q-icon-normal">
            </div>
            Inicio
        </a>
        <a href="{{url_for('programacion.agregar_programacion')}}" class="q-icon-costumer">
            <div class="mr-4 w-6 h-6">
                <img src="{{ url_for('static', filename='img/schedule.svg') }}" alt="qhawariy" srcset="" class="block q-icon-normal">
            </div>
            Programaciones
        </a>
        <a href="{{url_for('cronograma_vehiculos.mostrar_cronograma' ,busca='todos')}}" class="q-link-active q-link-exact-active ">
            <div class="mr-4 w-6 h-6">
                <img src="{{ url_for('static', filename='img/schedule_vehicle_blue.svg') }}" alt="qhawariy" srcset="" class="block q-icon-active">
            </div>
            Plan de flota
        </a>
        <a href="{{url_for('estadistica.mostrar_estadisticas')}}" class="q-icon-costumer">
            <div class="mr-4 w-6 h-6">
                <img src="{{ url_for('static', filename='img/statistic.svg') }}" alt="qhawariy" srcset="" class="block q-icon-normal">
            </div>
            Estadisticas
        </a>
    {% endif %}
{% endblock %}
{% block linker %}
<div class="flex">
    <img src="{{url_for('static', filename='img/icon-angle-right.svg')}}" alt="Descargar" class="">
</div>
<a href="{{ url_for('home.index') }}" class="btn--base">
    <p class="text-h3">Inicio</p>
</a>
<div class="flex">
    <img src="{{url_for('static', filename='img/icon-angle-right.svg')}}" alt="Descargar" class="">
</div>
<a href="#" class="btn--base">
    <p class="text-h3">Cronograma de plan de flota</p>
</a>
{% endblock %}
{% block content %}
<div class="flex items-center justify-between py-2 relative">
    <div class="">
        <p class="text-h4 text-black-100 md:mt-12">{{titulo|safe}}</p>
    </div>
    <a href="{{url_for('cronograma_vehiculos.agregar_permiso') }}" class="btn btn--base btn-gray-111">
        <div class="flex justify-center items-center">
            <img src="{{url_for('static', filename='img/planet.svg')}}" alt="Mapa" class="">
            <p class="ml-2 text-xs sm:hidden">Dar permiso</p>
        </div>
    </a>
    <div class="flex flex-col items-center justify-center right-0">
        <form action="" method="post" class="" novalidate>
            {{form_busca.hidden_tag()}}
            <div class="flex items-center relative">
                <div class=" inline-flex translateY-[-50%] right-unset left-3 absolute top-[50%]">
                    <img src="{{ url_for('static', filename='img/icon-len.svg') }}" height="24px" width="24px" alt>
                </div>
                {{ form_busca.busca(class="h-[42px] w-full rounded-full text-gris-900 px-12 border border-gray-209", placeholder="Buscar", autocomplete="on") }}<br>
            </div>
            <div class="mt-3">
                {% for error in form_busca.busca.errors %}
                <span class="text-red-600 text-xs">{{ error }}</span>
                {% endfor %}
            </div>
        </form>
    </div>
</div>
<div role="gantt-chart" class="relative">
    <div class="fixed modal-cronogram z-6 shadow shadow-custom bg-white border border-cream-100 p-4">
        <div class="relative">

            <a href="{#{ url_for('cronograma_vehiculos.eliminar_permiso', permiso_id=vp.id_vp) }#}" class="btn btn--base bg-red-600 rounded text-white">
                <div class="flex justify-center items-center">
                    <img src="{{url_for('static', filename='img/delete.svg')}}" alt="Descargar" class="">
                    <p class="ml-2 text-xs sm:hidden">Eliminar</p>
                </div>
            </a>
        </div>
    </div>
</div>
{% endblock %}
{% block javascript %}
<script  type="module">
    import { GanttChart } from "{{ url_for('static', filename='source/js/gantt/gantt-chart.js') }}";
    document.addEventListener("DOMContentLoaded",()=>{

        const tasks=JSON.parse('{{vehiculos|tojson|safe}}');
        const taskDurations=JSON.parse('{{permisos|tojson|safe}}')
        const date=JSON.parse('{{date|tojson|safe}}');
        
        //convertir string a Date
        taskDurations.forEach((taskDuration)=>{
            taskDuration.start=new Date(taskDuration.start);
            taskDuration.end=new Date(taskDuration.end);
        })
        console.log(taskDurations)

        const ganttCharts=document.querySelectorAll('[role="gantt-chart"]');
        ganttCharts.forEach((ganttChart)=>{
            new GanttChart(ganttChart,tasks,taskDurations,date.month,date.year);
        });
    });
</script>
{% endblock %}

