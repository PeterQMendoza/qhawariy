{% extends 'base.html' %}

{% block title %}
    Buscar vehiculo por programacion
{% endblock %}

{% block head %}
    {{ super() }}
    <script type="text/javascript" src="{{ url_for('static', filename='dist/js/chart.min.js') }}"></script>
{% endblock %}

{% block content %}
<div class="admin-page">
    <div class="md:pb-8 relative px-0">
        <div class="admin-detail bg-white rounded">
            <div class="w-full">
                <div class="admin-module-info bg-white p-6 md:w-full md:block block w-full">
                    <div class="px-0 md:px-6">
                        <div class="flex items-center justify-between pt-4">
                            <a href="{{ url_for('home.index') }}" class="btn p-1">
                                <div class="flex justify-center items-center">
                                    <img src="{{url_for('static', filename='img/back.svg')}}" alt="Descargar" class="">
                                    <p class="ml-2 text-xs sm:hidden">Volver inicio</p>
                                </div>
                            </a>
                            <h5 class="text-h5 text-black-100 md:mt-12 mb-6">Consultar vehiculos por programacion</h5>
                            <a href="{{ url_for('estadistica.mostrar_mapa') }}" class="btn bg-green-600 rounded text-white p-1">
                                <div class="flex justify-center items-center">
                                    <img src="{{url_for('static', filename='img/planet.svg')}}" alt="Mapa" class="">
                                    <p class="ml-2 text-xs sm:hidden">Ver mapa</p>
                                </div>
                            </a>
                        </div>
                        <div class="list-users pb-6 block w-full">
                            <div class="text-body-3 list-users-wrapper sm:grid-cols-1 grid gap-6 sm:gap-2 grid-cols-4 sm:gap-x-0">
                                <div class="flex items-center justify-between col-span-1">
                                    <form action="" method="post" novalidate>
                                        {{form.hidden_tag()}}
                                        <div class="mt-3">
                                            <div class="relative">
                                                <div class="w-full block">
                                                    {{ form.vehiculo.label }}
                                                    {{ form.vehiculo(class="rounded-xxs border text-black-100 text-sm w-full px-4 py-3 border-gray-400", placeholder="Codigo de ruta", autocomplete="off", maxlength="45") }}<br>
                                                </div>
                                            </div>
                                            {% for error in form.vehiculo.errors %}
                                            <span class="text-red-600 text-xs">{{ error }}</span>
                                            {% endfor %}
                                        </div>
                                        <div class=" mt-3">
                                            <div class="mt-4 mb-5">
                                                {{ form.submit(class="btn btn--base btn-green-600 font-semibold w-full md:w-auto block text-center py-2") }}
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="relative flex items-center justify-center col-span-3">
                                    <!-- pie chart -->
                                    <canvas id="chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block javascript %}
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded",()=>{
            var can=document.getElementById('chart');
            var dataset=JSON.parse('{{data|tojson|safe}}');
            const config={
                type: 'bar',
                data: {
                    datasets: [
                        {
                            data: dataset,
                            label:"cantidad",
                            backgroundColor:'#eb0046',
                            borderColor:'#eb0046',
                            fill:"#eb0046",
                        },
                    ]
                },
                options:{
                    responsive: true,
                    indexAxis: 'x',
                    parsing: {
                        xAxisKey: 'fecha',
                        yAxisKey: 'cantidad'
                    },
                    maintainAspectRatio: false,
                    aspectRatio:2,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Programacion de recorrido por ruta'
                        }
                    },
                    scales: {
                        y: {
                            stacked: true,
                            grid: {
                                display: true,
                                color: "rgba(255,99,132,0.2)",
                                drawOnChartArea: true,
                                drawTicks: true,
                            },
                            ticks: {
                                // forces step size to be 50 units
                                stepSize: 1
                            },
                        },
                        x: {
                            ticks: {
                                // forces step size to be 50 units
                                stepSize: 1000
                            },
                            grid: {
                                display: true
                            },
                            title:{
                                text:"Distancia",
                                display:true
                            }
                        }
                    }
                }
            }
            var chart=new Chart(can,config);
            // window.addEventListener('beforeprint', () => {
            //     chart.resize(800, 800);
            // });
            // window.addEventListener('afterprint', () => {
            //     chart.resize();
            // });

        });

        // window.addEventListener("resize",()=>{
        //     establecer_posiciones(pe);
        // });

    </script>
{% endblock %}